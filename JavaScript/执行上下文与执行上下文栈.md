# 执行上下文与执行上下文栈

## 0. 变量提升与函数提升

1. 变量声明提升
   * 通过 `var` 定义(声明)的变量，在定义语句之前就可以访问到
   * 值：`undefined`
2. 函数声明提升
   * 通过 `function` 声明的函数，在之前就可以直接调用
   * 值：函数定义(对象)

## 1. 执行上下文

1. 分类

   - 全局执行上下文
   - 函数执行上下文

2. 全局执行上下文

   1. 在执行全局代码前，将 `window` 确定为全局执行上下文对象
   2. 对全局数据进行预处理
      - `this` ==> 赋值（`window`）
      - `var` 定义的全局变量 ==> `undefined`，添加为 `window` 的属性
      - `function` 声明的全局函数 ==> 赋值（`fun`），添加为 `window` 的方法
   3. 执行代码

3. 函数执行上下文

   1. 在执行函数代码前，创建相对应的函数执行上下文对象

   2. 对局部数据进行预处理

      - `this` ==> 赋值（调用该函数的对象）
      - `var` 定义的局部变量 ==> `undefined`，添加为执行上下文对象的属性
      - `function` 声明的局部函数 ==> 赋值（`fun`），添加为执行上下文对象的方法

      **（对比全局数据多了以下两个函数特有的）**

      - 形参变量 ==> 赋值（实参），添加为执行上下文对象的属性
      - `arguments` ==> 赋值（实参列表），添加为执行上下文对象的属性

   3. 执行代码

## 2. 执行上下文栈

1. 在全局代码执行前，`JS` 引擎会创建一个栈用来存储管理所有的执行上下文对象
2. 在全局执行上下文对象（`window`）确定后，将其添加到栈中（压栈）
3. 在函数执行上下文对象创建后，将其添加到栈中（压栈）
4. 在当前函数执行完后，将栈顶的对象移除（出栈）
5. 当所有代码执行完毕后，栈中只剩下 `window`（`window` 出栈条件是应用程序退出，例如关闭网页或浏览器）